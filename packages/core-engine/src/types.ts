/**
 * ğŸ¯ PureSubs ç±»å‹å®šä¹‰
 * 
 * ä¸ºäº†æå‡ä»£ç è´¨é‡å’Œç±»å‹å®‰å…¨ï¼Œæˆ‘ä»¬å®šä¹‰äº†è¯¦ç»†çš„TypeScriptæ¥å£
 * æ¥æ›¿æ¢é¡¹ç›®ä¸­çš„ any ç±»å‹ä½¿ç”¨
 */

// =============================================================================
// YouTube Player Response ç›¸å…³ç±»å‹
// =============================================================================

/**
 * å•ä¸ªå­—å¹•è½¨é“çš„æ•°æ®ç»“æ„
 */
export interface CaptionTrack {
  baseUrl: string;
  name: {
    simpleText: string;
  };
  vssId: string;
  languageCode: string;
  kind?: string; // å¯é€‰å±æ€§ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„å­—å¹•æ‰æœ‰
  isTranslatable: boolean;
}

/**
 * æ’­æ”¾å™¨å­—å¹•è½¨é“åˆ—è¡¨æ¸²æŸ“å™¨
 */
export interface PlayerCaptionsTracklistRenderer {
  captionTracks: CaptionTrack[];
  audioTracks?: unknown[]; // YouTube å†…éƒ¨ç»“æ„ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“ç±»å‹
  translationLanguages?: unknown[]; // YouTube å†…éƒ¨ç»“æ„ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“ç±»å‹
}

/**
 * YouTube åˆå§‹æ’­æ”¾å™¨å“åº”ç»“æ„ï¼ˆæˆ‘ä»¬å…³å¿ƒçš„éƒ¨åˆ†ï¼‰
 */
export interface YtInitialPlayerResponse {
  captions?: {
    playerCaptionsTracklistRenderer: PlayerCaptionsTracklistRenderer;
  };
  videoDetails?: {
    videoId: string;
    title: string;
    lengthSeconds: string;
    keywords?: string[];
    channelId: string;
    isLive?: boolean;
  };
  playabilityStatus?: {
    status: string;
    reason?: string;
  };
}

// =============================================================================
// å†…å®¹è„šæœ¬å…¨å±€å¯¹è±¡ç±»å‹
// =============================================================================

/**
 * æŒ‚è½½åˆ° window å¯¹è±¡çš„ PureSubs å†…å®¹è„šæœ¬æ¥å£
 */
export interface PureSubsContentScript {
  getCachedSubtitleData: (videoId: string, language?: string) => SpyData | null;
  clearCache: () => void;
  getVersion: () => string;
}

/**
 * æ‰©å±•çš„ Window æ¥å£ï¼ŒåŒ…å« PureSubs ç›¸å…³å±æ€§
 */
export interface ExtendedWindow extends Window {
  puresubsContentScript: PureSubsContentScript;
  ytInitialPlayerResponse?: YtInitialPlayerResponse;
  ytInitialData?: Record<string, unknown>; // YouTube å†…éƒ¨æ•°æ®ï¼Œç»“æ„æå…¶å¤æ‚
}

// =============================================================================
// æ¶ˆæ¯ä¼ é€’ç±»å‹
// =============================================================================

/**
 * PostMessage äº‹ä»¶æ•°æ®ç±»å‹
 */
export interface PostMessageEventData {
  type: string;
  data?: Record<string, unknown> | SpyData;
  timestamp?: number;
}

/**
 * PostMessage äº‹ä»¶ç±»å‹
 */
export interface PostMessageEvent extends MessageEvent {
  data: PostMessageEventData;
}

// =============================================================================
// å­—å¹•æ•°æ®ç±»å‹
// =============================================================================

/**
 * å­—å¹•æ¡ç›®
 */
export interface SubtitleEntry {
  start: number;
  end: number;
  text: string;
  dur?: number;
}

/**
 * é—´è°æ‹¦æˆªçš„å­—å¹•æ•°æ®
 */
export interface SpyData {
  url: string;
  content: string;
  videoId: string;
  language: string;
  format: string;
  timestamp: number;
}

/**
 * ç­‰å¾…ä¸­çš„Promiseè¯·æ±‚
 */
export interface PendingRequest {
  resolve: (data: SpyData) => void;
  reject: (error: Error) => void;
  videoId: string;
  language: string;
  timestamp: number;
}

// =============================================================================
// ç”¨æˆ·åå¥½è®¾ç½®ç±»å‹
// =============================================================================

/**
 * ç”¨æˆ·åå¥½è®¾ç½®
 */
export interface UserPreferences {
  preferredLanguage: string;
  autoDownload: boolean;
  format: 'srt' | 'txt' | 'vtt';
  includeTimestamps: boolean;
}

// =============================================================================
// æ™ºèƒ½ä¸‹è½½ç»“æœç±»å‹
// =============================================================================

/**
 * æ™ºèƒ½å­—å¹•ä¸‹è½½ç»“æœ
 */
export interface SmartDownloadResult {
  success: boolean;
  content?: string;
  title?: string;
  description?: string;
  actualLanguage?: string;
  isAutoGenerated?: boolean;
  error?: string;
}

// =============================================================================
// DOM ç›¸å…³ç±»å‹
// =============================================================================

/**
 * æŒ‰é’®çŠ¶æ€ç±»å‹
 */
export type ButtonState = 'disabled' | 'ready' | 'loading' | 'success' | 'error';

/**
 * é€šçŸ¥ç±»å‹
 */
export type NotificationType = 'success' | 'error' | 'info' | 'warning';
