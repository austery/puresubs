# 产品需求文档 (PRD) v2.0：Project "PureSubs"

文档版本 日期 作者 状态
2.0 2025年7月31日 Gemini 定稿

## 1. 产品概述与战略 (Overview & Strategy)

“PureSubs” 是一个双核心项目，旨在构建：

一个强大、可复用的“核心数据引擎” (Core Engine)，能够以编程方式从任何YouTube视频URL中提取结构化的元数据和字幕。
一个基于该引擎的、轻量级的Chrome浏览器扩展 (Chrome Extension)，为用户提供在浏览时手动、即时下载字幕的无缝体验。
本项目的战略是通过“引擎优先”的模式，一次性解决数据提取的根本问题，然后将该能力同时赋能于手动场景（Chrome插件）和您未来的自动化工作流场景（如n8n节点），最大化开发投入的价值。

## 2. 产品目标 (Goals & Objectives)

核心目标：
引擎层： 创建一个100%可靠、经过充分测试的模块，作为未来所有相关应用的基石。
应用层： 为用户提供市面上最纯粹、最高效的YouTube字幕下载Chrome插件。
用户体验目标： 极简主义。对于插件用户，实现交互最少化，无广告、无干扰、即装即用。
技术目标：
核心引擎采用模块化设计，环境无关（可在浏览器和Node.js中运行）。
Chrome插件遵循Manifest V3规范，代码轻量，性能卓越。
成功指标：
引擎： 核心引擎的单元测试覆盖率达到95%以上。
插件： Chrome网上应用店用户评分稳定在4.5星以上，周活跃用户数持续增长。

## 3. 目标受众 (Target Audience)

主要用户： 内容创作者、研究人员、语言学习者。
核心用例：
手动场景： 浏览YouTube时，快速抓取当前视频的字幕和描述，用于即时分析或参考。
自动场景： 以编程方式批量处理视频链接，将产出的结构化数据送入后续的AI分析、笔记整理等自动化流程。

## 4. 功能需求 (Chrome插件 V1.0)

此部分定义了作为第一个产品的Chrome插件所具备的用户可见功能。

F1: 无缝UI集成
在YouTube视频页面的操作栏中，自动注入一个与页面风格一致的“下载字幕”按钮。
该按钮能智能判断当前视频是否存在字幕，若无则置灰或提示。
F2: 灵活的下载选项
点击按钮后，出现一个简洁的浮层，列出所有可用语言（需区分官方/自动生成）。
用户可选择下载为.srt（含时间码）或.txt（纯文本）格式。
用户可选择将视频的公开描述 (Description) 一并附加到下载的文件中。
F3: 个性化配置
提供一个简单的设置页面。
用户可以预设自己的首选下载语言（例如，总是优先下载zh-Hans）。
用户可以预设自己的首选下载格式（例如，总是下载.srt）。
设置保存后，点击插件主按钮可实现“一键下载”，无需每次重复选择。

## 5. 技术需求与架构 (Technical Requirements & Architecture)

核心架构： 项目必须采用“引擎/外壳”分离的模式。
核心引擎 (Core Engine): 一个独立的JS/TS模块，负责接收URL、发起网络请求、解析ytInitialPlayerResponse、解析XML字幕、格式化为SRT/TXT、并返回结构化JSON。此模块严禁包含任何UI或浏览器API相关的代码。
Chrome扩展 (Chrome Extension Shell): 作为“外壳”，负责处理所有UI交互、按钮注入、读取用户配置(chrome.storage)、调用“核心引擎”并处理其返回的数据、触发下载(chrome.downloads)。
测试要求： 核心引擎必须配备一套完整的自动化单元测试（推荐使用Jest框架），覆盖所有核心功能和边界情况（如无字幕、URL无效等）。
项目开发里程碑 (Milestone Plan)
这个里程碑规划完全基于我们讨论的“引擎优先”战略，确保每一步都为您的最终目标服务。

## 第一阶段：构建与验证“核心引擎” (The Foundation)

此阶段的目标是产出一个100%可靠、经过严密测试的数据提取模块。

### M1.1: 实现数据获取与解析

任务： 编写主函数 getYouTubeData(url)。实现模拟浏览器请求，获取YouTube视频页面的HTML源码。成功从源码中定位并完整提取 ytInitialPlayerResponse JSON对象。
验收标准： 输入一个URL，能将提取到的JSON对象打印到控制台。

### M1.2: 实现字幕与元数据提取

任务： 解析ytInitialPlayerResponse对象，成功提取出title, description，以及包含所有可用语言baseUrl的captionTracks数组。实现对字幕XML文件的获取和解析，将其转换为中间数据结构（如 [{start, end, text}, ...]）。
验收标准： 能打印出视频的标题、描述，以及指定语言的字幕文本数组。

### M1.3: 实现格式化与最终输出

任务： 编写格式化函数，将中间数据结构转换为最终的.srt和.txt字符串。
验收标准： getYouTubeData(url)能返回一个包含title, description, subtitles.srt, subtitles.txt的完整JSON对象。

### M1.4: 完成自动化测试

任务： 使用Jest等框架，为核心引擎编写全面的单元测试。利用本地HTML/XML文件作为模拟数据，覆盖标准、无字幕、多语言、ASR等所有边界情况。
验收标准： 所有测试用例通过，代码覆盖率达到95%以上。此里程碑完成后，第一阶段正式结束。
第二阶段：开发Chrome插件 (The First Application)
此阶段将核心引擎包装成一个用户友好的手动工具。

### M2.1: 插件MVP

任务： 创建最基础的插件框架。实现UI按钮的注入。点击按钮后，直接调用核心引擎（可硬编码一个语言如en），并将返回的SRT字符串触发下载。
验收标准： 在YouTube页面上点击按钮，能成功下载一个可用的英文字幕SRT文件。

### M2.2: 完善插件功能

任务： 开发语言/格式选择的UI浮层。开发配置页面，并使用chrome.storage保存用户偏好。将视频描述集成到下载选项中。
验收标准： 插件完整实现PRD中定义的所有功能。
第三阶段：赋能自动化工作流 (The Ultimate Goal)
此阶段实现您项目的初衷。

### M3.1: 集成至自动化工具

任务： 将第一阶段的“核心引擎”打包成一个标准的Node.js模块。在n8n中创建一个自定义节点（或编写一个独立的Node.js脚本），导入并调用该模块，实现输入URL列表、输出结构化数据的功能。
验收标准： 您的自动化流程可以成功运行，自动为指定的YouTube视频生成处理好的数据。
这个经过重构的规划，将确保您的项目从第一行代码开始，就走在通往最终目标的正确道路上。它结构清晰、风险可控，并为您未来的扩展打下了坚实的基础。
