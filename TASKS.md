# PureSubs 开发任务清单

## 当前状态 ✅
- [x] 项目基础架构搭建完成
- [x] Monorepo 结构创建
- [x] 核心引擎框架设计
- [x] Chrome 扩展基础框架
- [x] TypeScript 配置和构建系统
- [x] 测试环境配置
- [x] 代码质量工具配置 (ESLint, Prettier)

## 第一阶段：核心引擎实现 (M1 - 预计2-3周)

### M1.1: 数据获取与解析基础 📝
**优先级: 高**
- [ ] 实现 `fetchYouTubePageHTML()` 函数
  - [ ] 浏览器环境的 fetch 实现
  - [ ] Node.js 环境的 node-fetch 实现
  - [ ] 用户代理轮换机制
  - [ ] 错误处理和重试逻辑
- [ ] 实现 `extractPlayerResponse()` 函数
  - [ ] 正则表达式提取 ytInitialPlayerResponse
  - [ ] JSON 解析和验证
  - [ ] 错误处理
- [ ] 创建测试用例和模拟数据
  - [ ] 准备真实 YouTube 页面 HTML 样本
  - [ ] 创建单元测试

### M1.2: 元数据提取 📝
**优先级: 高**
- [ ] 实现 `extractVideoMetadata()` 函数
  - [ ] 标题提取
  - [ ] 描述提取
  - [ ] 视频时长获取
  - [ ] 上传日期获取
- [ ] 实现 `extractSubtitleTracks()` 函数
  - [ ] 字幕轨道列表解析
  - [ ] 语言信息解析
  - [ ] 自动生成vs手动字幕区分
  - [ ] 字幕URL提取
- [ ] 添加对应的单元测试

### M1.3: 字幕内容处理 📝
**优先级: 高**
- [ ] 实现 `fetchSubtitleXML()` 函数
  - [ ] XML 内容获取
  - [ ] 网络错误处理
  - [ ] 内容验证
- [ ] 完善 `parseSubtitleXML()` 函数
  - [ ] XML 解析逻辑
  - [ ] 时间戳转换
  - [ ] 文本清理和格式化
- [ ] 完善 `convertToSRT()` 函数
  - [ ] SRT 格式生成
  - [ ] 时间戳格式化
  - [ ] 序号管理
- [ ] 测试各种字幕格式和语言

### M1.4: 核心引擎集成 📝
**优先级: 高**
- [ ] 实现主函数 `getYouTubeData()`
  - [ ] 整合所有子功能
  - [ ] 选项参数处理
  - [ ] 错误传播和处理
  - [ ] 性能优化
- [ ] 全面测试覆盖
  - [ ] 正常情况测试
  - [ ] 边界情况测试 (无字幕、网络错误等)
  - [ ] 性能测试
  - [ ] 多语言字幕测试

### M1.5: 构建和发布准备 📝
**优先级: 中**
- [ ] 配置 Rollup 构建
- [ ] 生成类型定义文件
- [ ] 准备 npm 发布配置
- [ ] 创建使用示例和文档

## 第二阶段：Chrome 扩展开发 (M2 - 预计2-3周)

### M2.1: 基础功能实现 📅
**优先级: 高**
- [ ] 修复 Chrome 类型定义问题
- [ ] 实现内容脚本注入逻辑
- [ ] 创建下载按钮UI组件
- [ ] 集成核心引擎到扩展
- [ ] 实现基础下载功能

### M2.2: UI 和用户体验 📅
**优先级: 高**
- [ ] 创建语言选择界面
- [ ] 实现用户偏好设置页面
- [ ] 添加加载状态和进度指示
- [ ] 实现错误提示和用户反馈
- [ ] 优化按钮样式与 YouTube 集成

### M2.3: 高级功能 📅
**优先级: 中**
- [ ] 实现批量下载功能
- [ ] 添加字幕预览功能
- [ ] 实现下载历史记录
- [ ] 添加快捷键支持
- [ ] 性能优化和内存管理

## 第三阶段：测试和优化 (M3 - 预计1-2周)

### M3.1: 质量保证 📅
**优先级: 高**
- [ ] 完善单元测试覆盖率
- [ ] 集成测试和端到端测试
- [ ] 性能基准测试
- [ ] 兼容性测试 (不同 Chrome 版本)
- [ ] 安全性审查

### M3.2: 用户体验测试 📅
**优先级: 中**
- [ ] 用户界面可用性测试
- [ ] 不同 YouTube 页面布局测试
- [ ] 错误场景测试
- [ ] 用户反馈收集机制

### M3.3: 文档和发布准备 📅
**优先级: 中**
- [ ] 完善 README 和 API 文档
- [ ] 创建用户使用指南
- [ ] 准备 Chrome Web Store 提交材料
- [ ] 设置 CI/CD 流水线
- [ ] 准备发布版本

## 立即可以开始的任务 🚀

### 本周任务 (第1周)
1. **修复依赖和类型问题**
   - 安装缺失的依赖
   - 修复 TypeScript 类型错误
   - 确保构建系统正常运行

2. **实现核心功能骨架**
   - 完成 `fetchYouTubePageHTML()` 基础实现
   - 实现 URL 验证和视频ID提取
   - 创建第一个可运行的测试

3. **建立开发工作流**
   - 配置自动化测试
   - 设置代码格式化和检查
   - 确保热重载开发环境

### 下周任务 (第2周)
1. **YouTube 数据解析**
   - 研究和实现 ytInitialPlayerResponse 提取
   - 实现元数据解析逻辑
   - 建立字幕轨道发现机制

2. **测试数据准备**
   - 收集不同类型的 YouTube 视频样本
   - 创建模拟数据用于测试
   - 建立测试用例库

## 技术债务和注意事项 ⚠️

1. **依赖管理**
   - node-fetch 依赖需要正确配置
   - Chrome 扩展类型定义需要完善
   - pnpm workspace 配置需要优化

2. **安全考虑**
   - 内容安全策略 (CSP) 合规
   - 用户数据隐私保护
   - 网络请求安全性

3. **性能优化**
   - 减少内存占用
   - 优化网络请求频率
   - 实现合理的缓存策略

4. **兼容性**
   - 不同 YouTube 页面布局
   - Chrome 扩展 API 版本兼容
   - 多语言支持

## 风险评估 🔍

### 高风险项
- YouTube 页面结构变化可能影响数据提取
- Chrome 扩展政策变化可能影响发布
- 网络反爬虫机制可能阻止数据获取

### 缓解策略
- 实现多种备用提取方法
- 保持对平台政策的关注
- 实现智能请求频率控制
- 建立用户反馈和快速响应机制

---

*此任务清单将根据开发进度持续更新*
