# æ—¥å¿—åˆ†çº§å“²å­¦

## æ ¸å¿ƒåŸåˆ™

### æ—¥å¿—çš„æˆ˜ç•¥æ„ä¹‰

æ—¥å¿—ä¸ä»…ä»…æ˜¯è°ƒè¯•å·¥å…·ï¼Œæ›´æ˜¯ï¼š

- **ç³»ç»Ÿå¥åº·ç›‘æ§**çš„çœ¼ç›
- **ç”¨æˆ·ä½“éªŒé—®é¢˜**çš„æ”¾å¤§é•œ  
- **æ€§èƒ½ä¼˜åŒ–**çš„æŒ‡å—é’ˆ
- **æ•…éšœæ’æŸ¥**çš„å¯¼èˆªä»ª

### è®¾è®¡å“²å­¦

> **"æ—¥å¿—åº”è¯¥æ˜¯æ•…äº‹ï¼Œä¸æ˜¯å™ªéŸ³ã€‚æ¯æ¡æ—¥å¿—éƒ½åº”è¯¥æœ‰å…¶å­˜åœ¨çš„ä»·å€¼å’Œç›®çš„ã€‚"**

## åˆ†çº§æ ‡å‡†

### DEBUG çº§åˆ«

**ç”¨é€”**: è¯¦ç»†çš„æ‰§è¡Œæµç¨‹ï¼Œç”¨äºå¼€å‘è°ƒè¯•

**ä½¿ç”¨åœºæ™¯**:

- å‡½æ•°å…¥å‚å’Œè¿”å›å€¼
- å¾ªç¯å’Œæ¡ä»¶åˆ†æ”¯ç»†èŠ‚
- ä¸´æ—¶è°ƒè¯•ä¿¡æ¯

**ç¤ºä¾‹**:

```typescript
console.debug('[PureSubs Debug] ğŸ” Function extractSubtitles called with:', { 
  url, 
  options,
  timestamp: Date.now()
});

console.debug('[PureSubs Debug] ğŸ“Š Processing subtitle track:', {
  language: track.language,
  isAutoGenerated: track.isAutoGenerated,
  baseUrl: track.baseUrl.substring(0, 50) + '...'
});
```

**è¾“å‡ºæ§åˆ¶**:

```typescript
// ä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡º
if (process.env.NODE_ENV === 'development') {
  console.debug('[Debug]', data);
}
```

### INFO çº§åˆ«  

**ç”¨é€”**: å…³é”®çŠ¶æ€å˜åŒ–å’Œæ­£å¸¸æ“ä½œæµç¨‹

**ä½¿ç”¨åœºæ™¯**:

- ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
- å…³é”®æ“ä½œæˆåŠŸæ‰§è¡Œ
- çŠ¶æ€è½¬æ¢é€šçŸ¥
- ç”¨æˆ·æ“ä½œç¡®è®¤

**ç¤ºä¾‹**:

```typescript
console.info('[PureSubs] âœ… Spy script ready, button enabled');
console.info('[PureSubs] ğŸ¯ Subtitle extraction started for video:', videoId);
console.info('[PureSubs] ğŸ“¥ Downloaded subtitles:', {
  language: 'zh-Hans',
  format: 'SRT',
  entriesCount: 156
});
```

### WARN çº§åˆ«

**ç”¨é€”**: å¯æ¢å¤çš„é—®é¢˜å’Œéœ€è¦æ³¨æ„çš„å¼‚å¸¸æƒ…å†µ

**ä½¿ç”¨åœºæ™¯**:

- é™çº§ç­–ç•¥å¯ç”¨
- é…ç½®é—®é¢˜æé†’
- æ€§èƒ½è­¦å‘Š
- ä¸å®Œç¾ä½†å¯ç»§ç»­çš„çŠ¶æ€

**ç¤ºä¾‹**:

```typescript
console.warn('[PureSubs] âš ï¸ Primary language not found, falling back to:', fallbackLang);
console.warn('[PureSubs] âš ï¸ Network slow, subtitle loading may take longer');
console.warn('[PureSubs] âš ï¸ Chrome storage quota approaching limit:', usagePercent + '%');
```

### ERROR çº§åˆ«

**ç”¨é€”**: éœ€è¦å¤„ç†çš„é”™è¯¯å’Œå¼‚å¸¸

**ä½¿ç”¨åœºæ™¯**:

- åŠŸèƒ½å®Œå…¨å¤±è´¥
- ç½‘ç»œé”™è¯¯
- æ•°æ®è§£æé”™è¯¯
- ç”¨æˆ·éœ€è¦æ„ŸçŸ¥çš„é—®é¢˜

**ç¤ºä¾‹**:

```typescript
console.error('[PureSubs] âŒ Subtitle extraction failed:', {
  error: error.message,
  videoId,
  retryCount,
  stack: error.stack
});

console.error('[PureSubs] âŒ Network request failed:', {
  url: request.url,
  status: response.status,
  statusText: response.statusText
});
```

## ä¸Šä¸‹æ–‡å¢å¼º

### ç»“æ„åŒ–æ—¥å¿—

```typescript
interface LogContext {
  component: string;      // 'content-script' | 'background' | 'spy-script'
  action: string;         // 'extract' | 'parse' | 'download'
  videoId?: string;
  userId?: string;
  sessionId: string;
  timestamp: number;
}

class Logger {
  constructor(private context: LogContext) {}
  
  info(message: string, data?: any): void {
    console.info(`[${this.context.component}] ${message}`, {
      ...this.context,
      data,
      timestamp: Date.now()
    });
  }
}
```

### ç»„ä»¶æ ‡è¯†

```typescript
// å†…å®¹è„šæœ¬æ—¥å¿—
console.log('[PureSubs Content] ğŸ¯ Button injection started');

// åå°è„šæœ¬æ—¥å¿—  
console.log('[PureSubs Background] ğŸ”„ Tab switch detected');

// é—´è°è„šæœ¬æ—¥å¿—
console.log('[PureSubs Spy] ğŸ•µï¸ Network request intercepted');

// æ ¸å¿ƒå¼•æ“æ—¥å¿—
console.log('[PureSubs Core] âš™ï¸ Parsing subtitle XML');
```

### ç”Ÿå‘½å‘¨æœŸè¿½è¸ª

```typescript
// æ“ä½œå¼€å§‹
console.info('[PureSubs] ğŸš€ Subtitle extraction lifecycle started', {
  videoId,
  requestId: generateRequestId(),
  userAgent: navigator.userAgent
});

// å…³é”®æ­¥éª¤
console.info('[PureSubs] ğŸ“¡ Network interception setup complete');
console.info('[PureSubs] ğŸ” Subtitle tracks discovered:', trackCount);
console.info('[PureSubs] ğŸ“ Content parsing in progress');

// æ“ä½œå®Œæˆ
console.info('[PureSubs] âœ… Subtitle extraction lifecycle completed', {
  duration: Date.now() - startTime,
  resultSize: result.subtitles?.srt.length,
  success: true
});
```

## æ€§èƒ½ç›‘æ§é›†æˆ

### å…³é”®æŒ‡æ ‡è®°å½•

```typescript
interface PerformanceMetrics {
  extractionDuration: number;
  networkRequests: number;
  cacheHits: number;
  memoryUsage: number;
}

class PerformanceLogger {
  private metrics: PerformanceMetrics = {
    extractionDuration: 0,
    networkRequests: 0,
    cacheHits: 0,
    memoryUsage: 0
  };
  
  logPerformance(operation: string, duration: number): void {
    console.info(`[PureSubs Performance] ğŸ“Š ${operation}:`, {
      duration: `${duration}ms`,
      memory: this.getMemoryUsage(),
      timestamp: Date.now()
    });
  }
  
  private getMemoryUsage(): string {
    if ('memory' in performance) {
      const mem = (performance as any).memory;
      return `${Math.round(mem.usedJSHeapSize / 1024 / 1024)}MB`;
    }
    return 'N/A';
  }
}
```

### ç”¨æˆ·è¡Œä¸ºè¿½è¸ª

```typescript
// ç”¨æˆ·äº¤äº’æ—¥å¿—
console.info('[PureSubs User] ğŸ‘† Button clicked', {
  buttonState: 'ready',
  videoId,
  userSettings: getUserPreferences()
});

console.info('[PureSubs User] âš™ï¸ Settings changed', {
  previousLang: 'en',
  newLang: 'zh-Hans',
  autoDownload: true
});
```

## é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

### é”™è¯¯ä¸Šä¸‹æ–‡æ”¶é›†

```typescript
class ErrorCollector {
  static captureError(error: Error, context: any): void {
    const errorReport = {
      message: error.message,
      stack: error.stack,
      context,
      userAgent: navigator.userAgent,
      timestamp: Date.now(),
      url: window.location.href
    };
    
    console.error('[PureSubs Error] ğŸ’¥ Captured error:', errorReport);
    
    // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡ï¼ˆå¯é€‰ï¼‰
    if (process.env.NODE_ENV === 'production') {
      this.sendErrorReport(errorReport);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  const result = await extractSubtitles(url);
} catch (error) {
  ErrorCollector.captureError(error, {
    operation: 'extractSubtitles',
    url,
    options,
    retryCount
  });
}
```

### ç”¨æˆ·å‹å¥½é”™è¯¯

```typescript
// æŠ€æœ¯é”™è¯¯ -> ç”¨æˆ·å‹å¥½ä¿¡æ¯
const ErrorMessages = {
  NETWORK_ERROR: 'ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®',
  NO_SUBTITLES: 'è¯¥è§†é¢‘æš‚æ— å­—å¹•ï¼Œè¯·å°è¯•å…¶ä»–è§†é¢‘',
  PARSE_ERROR: 'å­—å¹•æ ¼å¼è§£æå¤±è´¥ï¼Œè¯·è”ç³»å¼€å‘è€…',
  TIMEOUT: 'è·å–å­—å¹•è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•'
};

function logUserError(errorCode: string, technicalDetails: any): void {
  // æŠ€æœ¯æ—¥å¿—
  console.error('[PureSubs Technical]', technicalDetails);
  
  // ç”¨æˆ·é€šçŸ¥
  console.info('[PureSubs User] ğŸ’¬ User message:', ErrorMessages[errorCode]);
}
```

## è°ƒè¯•å·¥å…·é›†æˆ

### å¼€å‘è€…è°ƒè¯•é¢æ¿

```typescript
// å¼€å‘ç¯å¢ƒä¸“ç”¨è°ƒè¯•å·¥å…·
if (process.env.NODE_ENV === 'development') {
  (window as any).PureSubsDebug = {
    enableVerboseLogging: () => {
      localStorage.setItem('puresubs_debug', 'true');
      location.reload();
    },
    
    exportLogs: () => {
      const logs = JSON.stringify(this.logHistory, null, 2);
      const blob = new Blob([logs], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `puresubs-logs-${Date.now()}.json`;
      a.click();
    },
    
    clearCache: () => {
      chrome.storage.local.clear();
      console.info('[PureSubs Debug] ğŸ—‘ï¸ Cache cleared');
    }
  };
}
```

### åŠ¨æ€æ—¥å¿—çº§åˆ«æ§åˆ¶

```typescript
class LogLevel {
  private static currentLevel = 'INFO';
  
  static setLevel(level: 'DEBUG' | 'INFO' | 'WARN' | 'ERROR'): void {
    this.currentLevel = level;
    localStorage.setItem('puresubs_log_level', level);
    console.info(`[PureSubs] ğŸ“Š Log level set to: ${level}`);
  }
  
  static shouldLog(level: string): boolean {
    const levels = ['DEBUG', 'INFO', 'WARN', 'ERROR'];
    const currentIndex = levels.indexOf(this.currentLevel);
    const messageIndex = levels.indexOf(level);
    return messageIndex >= currentIndex;
  }
}
```

## ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### æ—¥å¿—æ”¶é›†ç­–ç•¥

```typescript
// ç”Ÿäº§ç¯å¢ƒæ—¥å¿—é…ç½®
const ProductionLogger = {
  // åªä¿ç•™å…³é”®æ—¥å¿—
  info: (message: string, data?: any) => {
    if (this.isKeyMessage(message)) {
      console.info(message, data);
    }
  },
  
  warn: console.warn.bind(console),
  error: console.error.bind(console),
  
  // ç¦ç”¨è°ƒè¯•æ—¥å¿—
  debug: () => {},
  
  isKeyMessage: (message: string): boolean => {
    const keyPatterns = [
      'extraction completed',
      'user interaction',
      'performance metrics',
      'error occurred'
    ];
    return keyPatterns.some(pattern => message.includes(pattern));
  }
};
```

### ç”¨æˆ·åé¦ˆé›†æˆ

```typescript
// ç”¨æˆ·é‡åˆ°é—®é¢˜æ—¶çš„æ—¥å¿—å¯¼å‡º
function generateSupportPackage(): string {
  const supportData = {
    version: chrome.runtime.getManifest().version,
    userAgent: navigator.userAgent,
    recentLogs: this.getRecentLogs(100),
    settings: getUserPreferences(),
    timestamp: Date.now()
  };
  
  return JSON.stringify(supportData, null, 2);
}
```

## æ—¥å¿—åˆ†æä¸ç›‘æ§

### å…³é”®æŒ‡æ ‡å®šä¹‰

```typescript
interface LogMetrics {
  successRate: number;           // æˆåŠŸç‡
  averageExtractionTime: number; // å¹³å‡æå–æ—¶é—´
  errorFrequency: number;        // é”™è¯¯é¢‘ç‡
  cacheHitRate: number;          // ç¼“å­˜å‘½ä¸­ç‡
  userSatisfaction: number;      // ç”¨æˆ·æ»¡æ„åº¦
}

class LogAnalyzer {
  analyzeUserExperience(logs: LogEntry[]): UserExperienceReport {
    // åˆ†ææ—¥å¿—ï¼Œç”Ÿæˆç”¨æˆ·ä½“éªŒæŠ¥å‘Š
  }
}
```

---

*"ä¼˜ç§€çš„æ—¥å¿—æ˜¯æ— å£°çš„å¯¼å¸ˆï¼Œæ•™ä¼šæˆ‘ä»¬ç³»ç»Ÿçš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚"*  
*â€” PureSubs æ—¥å¿—å“²å­¦*
